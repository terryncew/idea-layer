{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Carbon Listing / Retirement Receipt (CLR) v0.1",
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "schema_version": { "const": "carbon/v0.1" },

    "cpr_id": { "type": "string", "minLength": 1 },
    "cvr_ids": {
      "type": "array",
      "items": { "type": "string" },
      "minItems": 0
    },

    "serials": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "registry": {
            "type": "string",
            "enum": ["verra", "goldstandard", "acr", "car", "puro", "other"]
          },
          "project_id": { "type": "string" },
          "range_start": { "type": "string" },
          "range_end": { "type": "string" }
        },
        "required": ["registry", "project_id", "range_start", "range_end"]
      }
    },

    "vintage_start": { "type": "string", "format": "date" },
    "vintage_end":   { "type": "string", "format": "date" },

    "quantity": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "nominal_tco2e":        { "type": "number", "minimum": 0 },
        "risk_adjusted_tco2e":  { "type": "number", "minimum": 0 },
        "buffer_held_tco2e":    { "type": "number", "minimum": 0 },
        "effective_tco2e":      { "type": "number", "minimum": 0 }
      },
      "required": ["nominal_tco2e", "risk_adjusted_tco2e", "effective_tco2e"]
    },

    "status": { "type": "string", "enum": ["listed", "transferred", "retired", "revoked"] },

    "retirement": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "date": { "type": "string", "format": "date" },
        "purpose": { "type": "string" },
        "claimant": { "type": "string" }
      }
    },

    "registry_anchor": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "registry": {
          "type": "string",
          "enum": ["verra", "goldstandard", "acr", "car", "puro", "other"]
        },
        "project_id": { "type": "string" },
        "serial_range": { "type": "string" },
        "issuance_date": { "type": "string", "format": "date" },
        "retirement_date": { "type": "string", "format": "date" },
        "verification_url": { "type": "string" }
      },
      "required": ["registry", "project_id", "serial_range", "verification_url"]
    },

    "quality": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "Kc": { "type": "number", "minimum": 0, "maximum": 1 },
        "delta_hol_carbon": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "biomass": { "type": "number", "minimum": 0, "maximum": 1 },
            "soil_carbon": { "type": "number", "minimum": 0, "maximum": 1 },
            "methane": { "type": "number", "minimum": 0, "maximum": 1 },
            "baseline_model": { "type": "number", "minimum": 0, "maximum": 1 }
          }
        }
      },
      "required": ["Kc"]
    },

    "buyer_disclosure": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "claim_type": { "type": "string", "enum": ["carbon_neutral", "net_zero", "offset"] },
        "scope": { "type": "string", "enum": ["product", "org", "event"] },
        "claimant": { "type": "string" },
        "public_statement_url": { "type": "string" }
      }
    },

    "rights": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "license": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "scope": {
              "type": "string",
              "enum": ["transfer", "retire", "research-noncommercial", "audit-only"]
            }
          },
          "required": ["scope"]
        },
        "royalty_split": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "creator": { "type": "number", "minimum": 0, "maximum": 1 },
            "validators": { "type": "number", "minimum": 0, "maximum": 1 },
            "platform": { "type": "number", "minimum": 0, "maximum": 1 }
          }
        }
      }
    },

    "provenance": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "iat": { "type": "string", "format": "date-time" },
        "sig": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "alg": { "type": "string", "enum": ["hmac-sha256", "ed25519"] },
            "kid": { "type": "string" },
            "sig": { "type": "string" }
          },
          "required": ["alg", "kid", "sig"]
        }
      },
      "required": ["iat", "sig"]
    }
  },
  "required": [
    "schema_version",
    "cpr_id",
    "serials",
    "vintage_start",
    "vintage_end",
    "quantity",
    "status",
    "registry_anchor",
    "provenance"
  ]
}
